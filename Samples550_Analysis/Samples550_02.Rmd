---
title: "metadata 553 samples"
output: html_document
date: "2024-03-13"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown
libraries
```{r}
library(here)
library(tidyverse)

library(vcfR)
```


```{r}
# from another R project
metadata553 = read.csv(here("../RP_230728_Metadata_ECC_study/Samples554_combined/Samples553_metadata_17_columns_231220.txt"),
                        sep = "\t", header = TRUE, stringsAsFactors = FALSE)
metadata553
```


```{r}
metadata553 %>% group_by(Sex) %>% summarise(n = n())
metadata553 %>% group_by(ECC_status) %>% summarise(n = n())
```


Required by plink Binary ('0' = control, '1' = case)
Required by plink Sex code ('1' = male, '2' = female, '0' = unknown)


```{r}
metadata553_2 = metadata553 %>% 
  select(sampleid, ECC_status, Sex) %>% 
  mutate(Family_id = sampleid) %>%
  mutate(Sex = case_when( # AS Original in data 1, Female | 2, Male 
    Sex == 0 ~ "Female",
    Sex == 1 ~ "Male")) %>% 
  mutate(Sex = case_when( # AS 	required by plink Sex code ('1' = male, '2' = female, '0' = unknown)
    Sex == "Female" ~ 2,
    Sex == "Male" ~ 1,
    TRUE ~ 0 )) %>% 
  relocate(sampleid, Family_id, Sex, ECC_status)
  
  
metadata553_2
```

### Check if the sampleid in the vcf file matches the sampleid in the metadata file
# get the sample names from the VCF file
```{r}
# Load the VCF file
vcf <- read.vcfR(here("Samples550_Analysis/Samples550_GATK/Samples550_55genes_GenotypeGVCFs.vcf"))
vcf
# Extract sample names
vcf_sample_names <- colnames(vcf@gt)[-1] %>% as.data.frame()

colnames(vcf_sample_names) = "sample_names"
vcf_sample_names
```


# Remove samples from vcf files
As We do not have metadata for these samples
the file name 550 actually has 554 samples
```{bash}
cd  /media/Second_stor/wasif/WK_Rprojects/RP_230718_Taste_Genes_Analysis_1/Samples550_Analysis/Samples550_GATK
# ^CIHR_103
bcftools view \
-s ^CIHR_103 \
./Samples550_55genes_GenotypeGVCFs.vcf > \
./Samples553_55genes_GenotypeGVCFs.vcf
```

### Check if the sampleid in the vcf file matches the sampleid in the metadata file
# get the sample names from the VCF file
```{r}
# Load the VCF file
vcf <- read.vcfR(here("Samples550_Analysis/Samples550_GATK/Samples553_55genes_GenotypeGVCFs.vcf"))
vcf
# Extract sample names
vcf_sample_names <- colnames(vcf@gt)[-1] %>% as.data.frame()

colnames(vcf_sample_names) = "sample_names"
vcf_sample_names
```


## Check if the names in the vcf file match the names in the metadata file
output should be true
```{r}
# Check if they are exactly the same
identical(vcf_sample_names$sample_names, metadata553_2$sampleid)

```

# Phenotype
```{r}
Phenotype = metadata553_2 %>% 
  dplyr::select(sampleid, Family_id, ECC_status)

write.table(Phenotype,
     here("Samples550_Analysis/Metadata_files/Samples553_Combined_Phenotype.txt"),
     col.names = F,
     row.names = F,
     quote = F,
     sep = "\t")
  
```

# Phenotype_with_sex_info
```{r}
Phenotype_with_sex_info = metadata553_2 %>% 
  dplyr::select(sampleid, Family_id, Sex, ECC_status)

write.table(Phenotype_with_sex_info,
     here("Samples550_Analysis/Metadata_files/Samples553_Combined_Phenotype_with_sex_info.txt"),
     col.names = F,
     row.names = F,
     quote = F,
     sep = "\t")
  
```

